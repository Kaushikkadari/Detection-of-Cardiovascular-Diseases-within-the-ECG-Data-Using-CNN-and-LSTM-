{% extends "base.html" %}

{% block title %}Image Processing - CardioDetect{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="h4 mb-0"><i class="fas fa-image me-2"></i>ECG Image Processing</h2>
            </div>
            <div class="card-body">
                <h3 class="h5 mb-3">Overview</h3>
                <p>
                    CardioDetect can analyze ECG data from images, making it possible to process ECG recordings that are only available as printouts, screenshots, or image files. Our advanced image processing algorithms extract the ECG signal from the image and convert it to a digital format that can be analyzed by our CNN-LSTM model.
                </p>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <img src="{{ url_for('static', filename='img/synthetic_ecg.png') }}" alt="ECG Image" class="img-fluid border rounded">
                        <p class="text-center text-muted mt-2">Example ECG Image</p>
                    </div>
                    <div class="col-md-6">
                        <img src="{{ url_for('static', filename='img/synthetic_ecg_processed.png') }}" alt="Processed ECG" class="img-fluid border rounded">
                        <p class="text-center text-muted mt-2">Extracted Signal and Analysis</p>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <h3 class="h5 mb-3">How It Works</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h4 class="h6 mb-0">Image Processing Pipeline</h4>
                            </div>
                            <div class="card-body">
                                <ol class="small">
                                    <li><strong>Image Preprocessing:</strong> The image is converted to grayscale and resized for consistent processing.</li>
                                    <li><strong>Thresholding:</strong> A binary threshold is applied to separate the ECG trace from the background.</li>
                                    <li><strong>Signal Extraction:</strong> The algorithm identifies the ECG line in each column of the image.</li>
                                    <li><strong>Signal Conversion:</strong> Pixel positions are converted to amplitude values.</li>
                                    <li><strong>Normalization:</strong> The extracted signal is normalized for consistent analysis.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h4 class="h6 mb-0">Supported Image Formats</h4>
                            </div>
                            <div class="card-body">
                                <ul class="small">
                                    <li><strong>JPG/JPEG:</strong> Common image format, widely used for photographs and scans.</li>
                                    <!-- <li><strong>PNG:</strong> Lossless image format, good for screenshots and digital ECG exports.</li>
                                    <li><strong>SVG:</strong> Vector image format (converted to PNG for processing).</li> -->
                                </ul>
                                <p class="small mt-3">
                                    <i class="fas fa-info-circle text-primary me-2"></i>
                                    Images are automatically processed regardless of their source - whether from a mobile phone camera, scanner, or digital export from an ECG device.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <h3 class="h5 mb-3">Best Practices for Image-Based Analysis</h3>
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h4 class="h6 text-primary"><i class="fas fa-check-circle me-2"></i>Recommended</h4>
                                <ul class="small">
                                    <li>Use clear, high-resolution images</li>
                                    <li>Ensure good contrast between the ECG line and background</li>
                                    <li>Crop the image to focus on the ECG trace</li>
                                    <li>Use images with a single lead for best results</li>
                                    <li>Ensure the ECG trace is continuous and visible</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h4 class="h6 text-danger"><i class="fas fa-times-circle me-2"></i>Avoid</h4>
                                <ul class="small">
                                    <li>Blurry or low-resolution images</li>
                                    <li>Images with grid lines darker than the ECG trace</li>
                                    <li>Images with multiple overlapping ECG traces</li>
                                    <li>Images with significant glare or shadows</li>
                                    <li>Images where the ECG trace is broken or incomplete</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Tip:</strong> For the most accurate results, digital ECG data (CSV, TXT, NPY) is preferred over image-based analysis. However, our image processing capabilities make it possible to analyze ECGs when digital data is not available.
                </div>
                
                <div class="text-center mt-4">
                    <a href="{{ url_for('demo', type='image') }}" class="btn btn-primary">
                        <i class="fas fa-vial me-2"></i>Try Image Processing Demo
                    </a>
                    <a href="{{ url_for('upload_file') }}" class="btn btn-outline-primary ms-2">
                        <i class="fas fa-upload me-2"></i>Upload Your ECG Image
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}